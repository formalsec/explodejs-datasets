{"version":3,"file":"index.esm.js","sources":["../../dist/core/src/distributor.js","../../dist/core/src/utils.js"],"sourcesContent":["export function distribute(reports, jobs) {\n    const sortedFilesWithStats = reports.sort((a, b) => {\n        return b.time - a.time;\n    });\n    function createBuckets(totalGroups) {\n        const buckets = [];\n        for (let i = 0; i < totalGroups; i++) {\n            buckets.push({ time: 0, files: [] });\n        }\n        return buckets;\n    }\n    function nextBucketBy(buckets) {\n        const mininumPropertyValue = Math.min(...buckets.map((b) => b.time));\n        return buckets.find((bucket) => bucket.time === mininumPropertyValue);\n    }\n    const buckets = createBuckets(jobs);\n    for (let i = 0; i < sortedFilesWithStats.length; i++) {\n        const bucket = nextBucketBy(buckets);\n        const { path, time } = sortedFilesWithStats[i];\n        bucket.time += time;\n        bucket.files.push(path);\n    }\n    return buckets;\n}\n","import fs from \"fs\";\nimport xmlParser from \"fast-xml-parser\";\nexport function loadXML(file) {\n    const junitRaw = fs.readFileSync(file, \"utf-8\");\n    return xmlParser.parse(junitRaw, {\n        ignoreAttributes: false,\n        attributeNamePrefix: \"\",\n    }, true);\n}\nexport function addNewFiles(reports, tests) {\n    let averageFileTime = 0;\n    if (reports.length) {\n        for (const report of reports) {\n            averageFileTime += report.time;\n        }\n        averageFileTime /= reports.length;\n    }\n    else {\n        averageFileTime = 1;\n    }\n    return tests.map((t) => {\n        const existing = reports.find((r) => r.path === t.path);\n        return existing || { path: t.path, time: averageFileTime };\n    });\n}\nexport function removeDeletedFiles(reports, tests) {\n    return reports.filter((r) => tests.some((t) => t.path === r.path));\n}\nexport function findFilenameInJUnit(testsuite, prop = \"file\") {\n    if (!testsuite) {\n        throw new Error(`Can't find file`);\n    }\n    if (Array.isArray(testsuite)) {\n        for (const t of testsuite) {\n            const file = findFilenameInJUnit(t, prop);\n            if (file) {\n                return file;\n            }\n        }\n    }\n    else if (typeof testsuite === \"object\") {\n        if (testsuite[prop]) {\n            return testsuite[prop];\n        }\n        if (testsuite.testsuite) {\n            return findFilenameInJUnit(testsuite.testsuite, prop);\n        }\n        if (testsuite.testcase) {\n            return findFilenameInJUnit(testsuite.testcase, prop);\n        }\n    }\n    throw new Error(`Can't find file`);\n}\n"],"names":[],"mappings":"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"}